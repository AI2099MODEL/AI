const STATIC_NSE_LIST = `Symbol
ADANIENSOL
ADANIENT
ADANIGREEN
ADANIPORTS
ADANIPOWER
ABCAPITAL
ABFRL
ABLBL
AJANTPHARM
AMBUJACEM
ANGELONE
APARINDS
APOLLOHOSP
APOLLOTYRE
APTUS
ASAHIINDIA
ASHOKLEY
ASIANPAINT
ATUL
AUROPHARMA
AXISBANK
BASF
BEML
BLS
BSE
BAJAJ-AUTO
BAJFINANCE
BAJAJFINSV
BAJAJHLDNG
BAJAJHFL
BANKBARODA
BANKINDIA
MAHABANK
BATAINDIA
BAYERCROP
BERGEPAINT
BDL
BEL
BHARATFORG
BHEL
BPCL
BHARTIARTL
BHARTIHEXA
BIKAJI
BIOCON
BSOFT
BLUEDART
FIRSTCRY
BRIGADE
BRITANNIA
CCL
CESC
CGPOWER
CRISIL
CAMPUS
CANFINHOME
CANBK
CAPLIPOINT
CGCL
CARBORUNIV
CASTROLIND
CEATLTD
CENTRALBK
CDSL
CENTURYPLY
CERA
CHALET
CHAMBLFERT
CHENNPETRO
CHOICEIN
CHOLAHLDNG
CHOLAFIN
CIPLA
CUB
CLEAN
COALINDIA
COCHINSHIP
COFORGE
CAMS
CONCORDBIO
CONCOR
COROMANDEL
CRAFTSMAN
CREDITACC
CROMPTON
CUMMINSIND
CYIENT
DCMSHRIRAM
DABUR
DALBHARAT
DATAPATTNS
DEEPAKFERT
DEEPAKNTR
DELHIVERY
DEVYANI
DIVISLAB
DIXON
AGARWALEYE
LALPATHLAB
DRREDDY
DUMMYHDLVR
EIDPARRY
EIHOTEL
EICHERMOT
ELECON
ELGIEQUIP
EMAMILTD
EMCURE
ENDURANCE
ENGINERSIN
ERIS
ESCORTS
ETERNAL
EXIDEIND
NYKAA
FEDERALBNK
FACT
FINCABLES
FINPIPE
FSL
FIVESTAR
FORCEMOT
FORTIS
GAIL
GVT&D
GMRAIRPORT
GLAXO
GLENMARK
GPIL
GODFRYPHLP
GODREJAGRO
GODREJCP
GODREJIND
GODREJPROP
GRANULES
GRAPHITE
GRASIM
GRAVITA
GESHIP
FLUOROCHEM
GUJGASLTD
GMDCLTD
GSPL
HCLTECH
HDFCAMC
HDFCBANK
HDFCLIFE
HFCL
HAPPSTMNDS
HAVELLS
HEROMOTOCO
HINDALCO
HAL
HINDCOPPER
HINDPETRO
HINDUNILVR
HINDZINC
POWERINDIA
HUDCO
HYUNDAI
ICICIBANK
ICICIGI
ICICIPRULI
IDBI
IFCI
IIFL
INOXINDIA
IRB
IRCON
ITCHOTELS
ITC
ITI
INDIANB
IEX
INDHOTEL
IOC
IOB
IRCTC
IRFC
IREDA
IGL
INFY
INOXWIND
INTELLECT
INDIGO
IGIL
IKS
IPCALAB
JBCHEPHARM
JKCEMENT
JBMA
JKTYRE
JMFINANCIL
JSWENERGY
JSWINFRA
JSWSTEEL
JPPOWER
J&KBANK
JINDALSAW
JSL
JINDALSTEL
JIOFIN
JUBLFOOD
JUBLINGREA
JUBLPHARMA
LTF
LTTS
LICHSGFIN
LTFOODS
LTIM
LT
LAURUSLABS
THELEELA
LEMONTREE
LICI
LINDEINDIA
LLOYDSME
LODHA
LUPIN
MMTC
MRF
MGL
MAHSCOOTER
MAHSEAMLES
M&MFIN
M&M
MANAPPURAM
MRPL
MANKIND
MARICO
MARUTI
MFSL
MAXHEALTH
MAZDOCK
METROPOLIS
MINDACORP
MSUMI
MOTILALOFS
MPHASIS
MCX
MUTHOOTFIN
NATCOPHARM
NBCC
NCC
NHPC
NLCINDIA
NMDC
NSLNISP
NTPCGREEN
NTPC
ONGC
OIL
OLAELEC
OLECTRA
PAYTM
ONESOURCE
OFSS
PTCIL
PVRINOX
PAGEIND
PATANJALI
PETRONET
PFC
POWERGRID
PNB
RBLBANK
RECLTD
RHIM
RITES
RVNL
RAILTEL
REDINGTON
RELIANCE
RELINFRA
RPOWER
SBFC
SBICARD
SBILIFE
SJVN
SAIL
SAILIFE
SAMMAANCAP
MOTHERSON
SCHNEIDER
SCI
SHREECEM
SHRIRAMFIN
SOBHA
SOLARINDS
SONACOMS
STARHEALTH
SBIN
SAIL
SUMICHEM
SUNPHARMA
SUNTV
SWIGGY
TVSMOTOR
TATACHEM
TATACOMM
TCS
TATACONSUM
TATAELXSI
TATAINVEST
TMPV
TATAPOWER
TATASTEEL
TATATECH
TTML
TECHM
TITAGARH
TITAN
TORNTPHARM
TORNTPOWER
TRENT
TRIDENT
TRIVENI
TRITURBINE
UCOBANK
UNOMINDA
UPL
UTIAMC
ULTRACEMCO
UNIONBANK
VGUARD
VTL
VBL
VEDL
VOLTAS
WIPRO
WOCKPHARMA
YESBANK
ZYDUSLIFE

export const STATIC_MCX_LIST = [
  "GOLD", "SILVER", "CRUDEOIL", "NATURALGAS", "COPPER", "ZINC", "ALUMINIUM", "LEAD"
];

export const STATIC_FOREX_LIST = [
  "USDINR", "EURINR", "GBPINR", "JPYINR", "EURUSD", "GBPUSD"
];

export const STATIC_CRYPTO_LIST = [
  "BTC", "ETH", "SOL", "BNB", "XRP", "ADA"
];

let NAME_CACHE: Map<string, string> | null = null;

const initNameCache = () => {
  if (NAME_CACHE) return;
  NAME_CACHE = new Map<string, string>();
  const lines = STATIC_NSE_LIST.split("\n");

  for (let i = 1; i < lines.length; i++) {
    const line = lines[i].trim();
    if (!line) continue;
    const parts = line.split(",");
    const sym = parts[0].trim().toUpperCase();
    if (sym) {
      // CSV has only symbols, so map symbol -> itself
      NAME_CACHE.set(sym, sym);
    }
  }
};

export const getCompanyName = (symbol: string): string => {
  if (!NAME_CACHE) initNameCache();

  // normalize to base symbol (strip any .NS / .BO etc.)
  const base = symbol.toUpperCase().replace(/\.(NS|BO)$/i, "");

  if (NAME_CACHE?.has(base)) return NAME_CACHE.get(base)!;

  if (STATIC_MCX_LIST.includes(base)) return `${base} Futures (MCX)`;
  if (STATIC_FOREX_LIST.includes(base)) return `${base.substring(0, 3)}/${base.substring(3)} Forex`;
  if (STATIC_CRYPTO_LIST.includes(base)) return `${base} Crypto`;

  return base;
};

const parseCSV = (text: string): string[] => {
  const lines = text.split("\n");
  if (lines.length < 2) return [];

  const symbols: Set<string> = new Set();

  for (let i = 1; i < lines.length; i++) {
    const line = lines[i].trim();
    if (!line) continue;

    const cols = line.split(",");
    const sym = cols[0].trim().toUpperCase();

    if (sym && /^[A-Z0-9&-]+$/.test(sym) && sym !== "Symbol") {
      symbols.add(sym);
    }
  }

  return Array.from(symbols);
};

export const checkAndRefreshStockList = async (): Promise<string[]> => {
  return parseCSV(STATIC_NSE_LIST);
};
